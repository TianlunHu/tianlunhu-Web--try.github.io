<!DOCTYPE html> 
<html>
    
    <head>
        
        <meta charset="utf-8">
        <meta name="description" content="WebRTC code samples">
        <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
        
        <meta itemprop = "description" content="Client-side WebRTC code samples">
        <meta itemprop = "name" content="WebRTC code samples">
        <meta name="mobile-web-app-capable" content="yes">
        <meta id="theme-color" name="theme-color" content="#ffffff">
        
        <base target="_blank">
        <title>Video Capture</title>
        
        <link href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="main.css">
        
    </head>
    
    <body>
    
    <div id="container">
        <h1> Sensor Data Collection : <span>Video Capture</span></h1>
    
        <h2> Take Frame with Button </h2>
        <video playsinline autoplay></video>
        <canvas></canvas>
        
        <button>Take Frame</button>
        
        
        <p>Display the video stream from <code>getUserMedia()</code> in a video element.</p>
        <p>Draw a frame from the video onto the canvas element using the <code>drawImage()</code> method.</p>

        <br />
        <h1> Sensor Data Collection : <span>Motion Capture</span></h1>
        <h2> Read Data from Motion Sensors</h2>
        <table class="table table-striped table-bordered">
            <tr>
                <td>API used</td>
                <td id="moApi">Sensors not available</td>
            </tr>
            <tr>
                <td>linear acceleration (excl. gravity)</td>
                <td id="moAccel">No Accelermeter</td>
            </tr>
            <tr>
                <td>acceleration incl. gravity</td>
                <td id="moAccelGrav">No Accelermeter</td>
            </tr>
            <tr>
                <td>rotation rate</td>
                <td id="moRotation">No Gyroscope</td>
            </tr>
            <tr>
                <td>interval (ms)</td>
                <td id="moInterval">Infinity</td>
            </tr>
        </table>
        
        <br />
        <h1> Sensor Data Collection : <span>Network State</span></h1>
        <p> Current Network Connection Type is <b id="networkType">not available</b>.</p>
        <p> Current Network Connection effective Type is <b id="effectiveNetworkType">not available</b>.</p>
        <p> Current max download speed is <b id="downlinkMax">not available</b>.</p>
        
        <h1> WebSocket Connection ï¼š<span>Data Send</span></h1>
        <a id="Socket" href="javascript:runWebSocket()">Run WebSocket</a>
        <p id="Data"></p>
        <p id="Receive"></p>
    </div>
        
    <script type="text/javascript">
        if ('LinearAccelerationSensor' in window && 'Gyroscope' in window) {
            document.getElementById('moApi').innerHTML = 'Motion Sensor';

            let lastReadingTimestamp;
            let accelerometer = new LinearAccelerationSensor();
            accelerometer.addEventListener('reading', e => {
            if (lastReadingTimestamp) {
                intervalHandler(Math.round(accelerometer.timestamp - lastReadingTimestamp));
            }
            lastReadingTimestamp = accelerometer.timestamp
            accelerationHandler(accelerometer, 'moAccel');
            });
            accelerometer.start();

            if ('GravitySensor' in window) {
                let gravity = new GravitySensor();
                gravity.addEventListener('reading', e => accelerationHandler(gravity, 'moAccelGrav'));
                gravity.start();
            }

            let gyroscope = new Gyroscope();
            gyroscope.addEventListener('reading', e => rotationHandler({
            alpha: gyroscope.x,
            beta: gyroscope.y,
            gamma: gyroscope.z
            }));
            gyroscope.start();

        }
        
        else if ('DeviceMotionEvent' in window) {
            document.getElementById('moApi').innerHTML = 'Device Motion API';

            var onDeviceMotion = function(eventData) {
                accelerationHandler(eventData.acceleration, 'moAccel');
                accelerationHandler(eventData.accelerationIncludingGravity, 'moAccelGrav');
                rotationHandler(eventData.rotationRate);
                intervalHandler(eventData.interval);
            }

            window.addEventListener('devicemotion', onDeviceMotion, false);
        }
        
        else {
            document.getElementById('moApi').innerHTML = 'No Accelerometer & Gyroscope API available';
        }
        
    </script>
        
    <script type="text/javascript">
        function Change(){
            document.getElementById("ding").innerHTML = "YYYYYYYYYYYY";
        }
        function Alert(){
            var y = document.getElementById("in").value;
            if(y=""||isNaN(y))
                {
                    alert("Not Numeric");
                }
            else{alert("NB")}
        }
    </script>
        
    <script type="text/javascript">
        
        function runWebSocket(){
            if ("WebSocket" in window){
                //alert("WebSocket is available");
                var ws = new WebSocket("ws://localhost:9998/echo");
                //var ws = new WebSocket("wss://10.210.49.28:9998/echo");
                ws.onopen = function(){
                    ws.send('Send Data');
                    document.getElementById('Data').innerHTML = 'Sending Data';
                };
                
                ws.onmessage = function(evt){
                    var received_msg = evt.data;
                    document.getElementById('Receive').innerHTML = 'Data Received';
                };
                
                ws.onclose = function(){
                    //document.getElementById('Socket').innerHTML = 'Connection closed';
                    alert('Connection closed');
                }
                
            }
            
            else {
                document.getElementById('Socket').innerHTML = 'WebSocket is not available in your browser';
            }
        }
        
    </script>
        
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="getVideo.js"></script>
    <script src="Sensor.js"></script>
    <script src="Network.js"></script>
    
    </body>
</html>
        
    
